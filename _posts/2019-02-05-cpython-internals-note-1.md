---
layout:     post
title:      "从图灵机到Cpython - Cpython Internals Notes (1)"
subtitle:   "Cpython虚拟机学习笔记系列"
date:       2019-2-05 12:00:00
author:     "Baymax"
header-img: "img/post-bg-agt-5.jpg"
catalog: true
tags:
    - Python
    - Study Notes
---

> Cpython虚拟机学习笔记系列
> 油管视频：[CPython internals: A ten-hour codewalk](https://pg.ucsd.edu/cpython-internals.htm)
> github博客：[zpoint/CPython-Internals](https://github.com/zpoint/CPython-Internals)
> github源码：[python/cpython](https://github.com/python/cpython)

## 图灵机

其实学校里就有学习过图灵机的相关概念，但是在工作的过程中逐渐忘记了这些内容，直到今天突然刷到了一个知乎问题：[什么是图灵完备](https://www.zhihu.com/question/20115374)，让我突然又对这个概念提起了兴趣。

### 图灵完备

首先，图灵机并不是一种实体的机器，它只是一种抽象概念和数学模型，关于它的描述各种百科都有，可以参考：[Wiki - 图灵机](https://zh.wikipedia.org/wiki/%E5%9B%BE%E7%81%B5%E6%9C%BA)、[百度百科 - 图灵机](https://baike.baidu.com/item/%E5%9B%BE%E7%81%B5%E6%9C%BA)。这里我摘录了百度百科中的相关描述：

1. 一条无限长的纸带 TAPE。纸带被划分为一个接一个的小格子，每个格子上包含一个来自有限字母表的符号，字母表中有一个特殊的符号 表示空白。纸带上的格子从左到右依此被编号为 0，1，2，... ，纸带的右端可以无限伸展。
2. 一个读写头 HEAD。该读写头可以在纸带上左右移动，它能读出当前所指的格子上的符号，并能改变当前格子上的符号。 
3. 一套控制规则 TABLE。它根据当前机器所处的状态以及当前读写头所指的格子上的符号来确定读写头下一步的动作，并改变状态寄存器的值，令机器进入一个新的状态。
4. 一个状态寄存器。它用来保存图灵机当前所处的状态。图灵机的所有可能状态的数目是有限的，并且有一个特殊的状态，称为停机状态。参见停机问题。

关于图灵机的描述可能非常复杂难懂，并且会让人难以理解其作用，但是图灵证明的结论却非常简单：

> 只要实现了图灵机，就可以用它来解决任何可计算问题。

只要某个系统实现了图灵机的所有功能，那么这个系统就是图灵完备的，知乎上还有一个很有趣的问题：[你无意中发现过哪些图灵完备的系统](https://www.zhihu.com/question/56501530)。

对于一种语言或者系统来说，是不是图灵完备是一种很重要的特性，它意味着这种语言或系统是不是可以解决任何计算问题。现代编程语言，比如：C++、Java、Python等都是图灵完备的。

### 实现图灵机

目前我们在做一些ToB的产品，用于金融行业的数据计算等工作，其实用户的各种功能都可以被解释成“可计算问题”，产品的本质也是创造一种工具去解决用户的“可计算问题”，不过目前这个产品还不是图灵完备的，因为会图灵完备会大大提升用户的使用成本。

上面的知识和思考让我第一次站到了一个语言设计者的视角来观察语言和框架的问题。首先，一种通用编程语言是需要图灵完备的，否则一定会有一些数据结构和算法无法实现，从而不能解决所有的问题。其次，实现图灵机最简单的方法其实是模仿图灵机原本的设计，站在巨人的肩膀上总是没错的，这也从另一个侧面解释了为什么操作系统（C语言运行环境）、JVM和Python虚拟机都有堆、栈等概念，并且是相似的。

有了上面这些背景，在后面学习CPython虚拟机的时候，会有一些常见对象，比如PyObject、FunctionFrame等，其实都可以映射到图灵机中的相关概念。

## Cpython源码

